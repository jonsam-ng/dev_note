# 组件主题设计探究
## 利用context.Provider来共享样式
### 思路
1. 定义主题样式来覆盖原有的样式。
2. getStyle可以获取主题样式和主动传递的样式变量。
3. 创建Provider分发样式。
4. 创建Consumer可以使用样式。
5. 使用样式的组件必须被Provider包裹，组件能够获取到主题变量并使用。

### 设计样式表
![[style_provider_consumer.png]]
### DEMO
```js
/* eslint-disable react-hooks/rules-of-hooks */
import React, { createContext, ReactChild } from "react";

interface IProps {}
interface ThemeProviderProps {
  theme: string | object;
  children: ReactChild;
}
interface ThemeConsumerProps {
  children: Function;
}

// 默认主题
const defaultTheme: object = {
  themeColor: "red",
};

// 明亮主题
const lightStyleSheet = {};

// 暗黑主题
const darkStyleSheet = {};

// 使用主题的hook
const useTheme = (args = {}) => {
  return Object.assign({}, defaultTheme, args);
};

/**
 * @desc 获取当前使用的样式
 */
const getStyle = (style: any): object => {
  if (style === "light") {
    return useTheme(lightStyleSheet);
  } else if (style === "dark") {
    return useTheme(darkStyleSheet);
  } else {
    const themeStyle =
      style && style.theme === "dark" ? darkStyleSheet : lightStyleSheet;
    return useTheme({ ...themeStyle, ...style });
  }
};

// 创建context
const themeCtx = createContext(defaultTheme);

// 创建Provider
const ThemeProvider = (props: ThemeProviderProps) => {
  // 获取当前使用样式
  const style = getStyle(props.theme);
  // 将样式引用到children
  return <themeCtx.Provider value={style}>{props.children}</themeCtx.Provider>;
};

// 创建consumer使用样式
const ThemeConsumer = (props: ThemeConsumerProps) => {
  return (
    <themeCtx.Consumer>
      {(style) => {
        return props.children(style);
      }}
    </themeCtx.Consumer>
  );
};

const ThemeChild = () => (
  <ThemeConsumer>
    {(theme: any) => {
      return (
        <p
          style={{
            fontSize: theme.defaultFontSize,
            color: theme.themeColor,
          }}
        >
          使用主题的子组件
        </p>
      );
    }}
  </ThemeConsumer>
);

const ThemeDemo = (props: IProps) => {
  return (
    <div className="cantainre">
      {/* Provider */}
      <ThemeProvider theme={{ theme: "dark", defaultFontSize: 18 }}>
        <ThemeChild />
      </ThemeProvider>
    </div>
  );
};

export default ThemeDemo;
```

## antD的主题定制方法
### modifyVars 覆盖变量

## 参考文章
- [基于react的组件库主题设计方案](https://cloud.tencent.com/developer/article/1663404)
- [React组件设计实践总结03 - 样式的管理](https://juejin.im/post/6844903843902275592#heading-22)
- [React组件库主题设计](https://github.com/whinc/blog/issues/4)